# 2. åŸºæœ¬æ¦‚å¿µã®ç†è§£

## ğŸŒ ã‚°ãƒ©ãƒ•æ§‹é€ ã§ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°

### å¾“æ¥ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° vs ã‚°ãƒ©ãƒ•æ§‹é€ 

#### å¾“æ¥ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ï¼ˆç·šå½¢ï¼‰
```
é–‹å§‹ â†’ å‡¦ç†A â†’ å‡¦ç†B â†’ å‡¦ç†C â†’ çµ‚äº†
```

#### ã‚°ãƒ©ãƒ•æ§‹é€ ï¼ˆéç·šå½¢ï¼‰
```
       â”Œâ”€ å‡¦ç†B â”€â”
é–‹å§‹ â†’ åˆ†å²      â†’ çµåˆ â†’ çµ‚äº†
       â””â”€ å‡¦ç†C â”€â”˜
```

### ã‚°ãƒ©ãƒ•æ§‹é€ ã®åˆ©ç‚¹

1. **æŸ”è»Ÿãªåˆ¶å¾¡ãƒ•ãƒ­ãƒ¼**: æ¡ä»¶ã«å¿œã˜ãŸå‹•çš„ãªå‡¦ç†é¸æŠ
2. **ä¸¦åˆ—å‡¦ç†**: è¤‡æ•°ã®å‡¦ç†ã‚’åŒæ™‚å®Ÿè¡Œ
3. **ãƒ«ãƒ¼ãƒ—å‡¦ç†**: æ¡ä»¶ã‚’æº€ãŸã™ã¾ã§ç¹°ã‚Šè¿”ã—
4. **å¯è¦–åŒ–**: å‡¦ç†ã®æµã‚Œã‚’å›³ã§è¡¨ç¾å¯èƒ½

## ğŸ”— ãƒãƒ¼ãƒ‰ï¼ˆå‡¦ç†ã®å˜ä½ï¼‰ã¨ã‚¨ãƒƒã‚¸ï¼ˆã¤ãªãæ–¹ï¼‰

### ãƒãƒ¼ãƒ‰ï¼ˆNodeï¼‰
å‡¦ç†ã®æœ€å°å˜ä½ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªå½¹å‰²ã‚’æŒã¡ã¾ã™ï¼š

#### ãƒãƒ¼ãƒ‰ã®ç¨®é¡
- **å‡¦ç†ãƒãƒ¼ãƒ‰**: å®Ÿéš›ã®å‡¦ç†ã‚’è¡Œã†ï¼ˆLLMå‘¼ã³å‡ºã—ã€è¨ˆç®—ãªã©ï¼‰
- **æ¡ä»¶ãƒãƒ¼ãƒ‰**: æ¬¡ã®å‡¦ç†ã‚’æ±ºå®šã™ã‚‹
- **é–‹å§‹ãƒãƒ¼ãƒ‰**: ã‚°ãƒ©ãƒ•ã®é–‹å§‹ç‚¹
- **çµ‚äº†ãƒãƒ¼ãƒ‰**: ã‚°ãƒ©ãƒ•ã®çµ‚äº†ç‚¹

#### ãƒãƒ¼ãƒ‰ã®å®Ÿè£…ä¾‹
```python
def my_node(state):
    # çŠ¶æ…‹ã‚’å—ã‘å–ã‚Š
    current_state = state
    
    # ä½•ã‚‰ã‹ã®å‡¦ç†ã‚’å®Ÿè¡Œ
    result = process_data(current_state["data"])
    
    # çŠ¶æ…‹ã‚’æ›´æ–°ã—ã¦è¿”ã™
    return {"result": result}
```

### ã‚¨ãƒƒã‚¸ï¼ˆEdgeï¼‰
ãƒãƒ¼ãƒ‰é–“ã®æ¥ç¶šã‚’å®šç¾©ã—ã¾ã™ï¼š

#### ã‚¨ãƒƒã‚¸ã®ç¨®é¡
- **é€šå¸¸ã‚¨ãƒƒã‚¸**: A â†’ B ã®ç›´æ¥æ¥ç¶š
- **æ¡ä»¶ã‚¨ãƒƒã‚¸**: æ¡ä»¶ã«å¿œã˜ã¦A â†’ B or C
- **é–‹å§‹ã‚¨ãƒƒã‚¸**: é–‹å§‹ãƒãƒ¼ãƒ‰ã¸ã®æ¥ç¶š
- **çµ‚äº†ã‚¨ãƒƒã‚¸**: çµ‚äº†ã¸ã®æ¥ç¶š

#### æ¡ä»¶ã‚¨ãƒƒã‚¸ã®ä¾‹
```python
def decide_next_node(state):
    if state["score"] > 0.8:
        return "high_quality_node"
    else:
        return "improvement_node"
```

## ğŸ“Š StateGraph

### çŠ¶æ…‹ç®¡ç†ã®é‡è¦æ€§

LangGraphã§ã¯ã€å…¨ã¦ã®æƒ…å ±ã‚’ã€ŒçŠ¶æ…‹ï¼ˆStateï¼‰ã€ã¨ã—ã¦ç®¡ç†ã—ã¾ã™ã€‚

#### çŠ¶æ…‹ã®å½¹å‰²
- **ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—**: ãƒãƒ¼ãƒ‰é–“ã§ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰
- **å±¥æ­´ã®ä¿æŒ**: éå»ã®å‡¦ç†çµæœã‚’è¨˜éŒ²
- **åˆ¶å¾¡æƒ…å ±**: æ¬¡ã®å‡¦ç†ã‚’æ±ºå®šã™ã‚‹ãŸã‚ã®æƒ…å ±

### StateGraphã®åŸºæœ¬æ§‹é€ 

```python
from langgraph.graph import StateGraph
from typing import TypedDict, List

# çŠ¶æ…‹ã®å®šç¾©
class AgentState(TypedDict):
    messages: List[str]
    current_step: str
    result: str

# StateGraphã®ä½œæˆ
workflow = StateGraph(AgentState)

# ãƒãƒ¼ãƒ‰ã®è¿½åŠ 
workflow.add_node("process_input", process_input_node)
workflow.add_node("generate_response", generate_response_node)

# ã‚¨ãƒƒã‚¸ã®è¿½åŠ 
workflow.add_edge("process_input", "generate_response")
workflow.add_edge("generate_response", END)

# é–‹å§‹ç‚¹ã®è¨­å®š
workflow.set_entry_point("process_input")
```

## ğŸ“ ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ

### å®Ÿè¡Œé€”ä¸­ã‹ã‚‰ã®å†é–‹

ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆæ©Ÿèƒ½ã«ã‚ˆã‚Šã€ä»¥ä¸‹ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ï¼š

#### 1. **ä¸­æ–­ã¨å†é–‹**
```python
# å®Ÿè¡Œã®ä¸­æ–­
checkpoint = graph.get_state(thread_id)

# å¾Œã§å†é–‹
result = graph.invoke(input_data, thread_id=thread_id)
```

#### 2. **å±¥æ­´ã®æ´»ç”¨**
```python
# éå»ã®çŠ¶æ…‹ã‚’å–å¾—
history = graph.get_state_history(thread_id)
for state in history:
    print(f"Step: {state.step}, State: {state.values}")
```

#### 3. **åˆ†å²ç‚¹ã§ã®é¸æŠ**
```python
# äººé–“ã®åˆ¤æ–­ã‚’å¾…ã¤
state = graph.invoke(input_data, interrupt_before=["human_review"])
# äººé–“ãŒåˆ¤æ–­å¾Œã€ç¶šè¡Œ
result = graph.invoke(None, thread_id=thread_id)
```

### ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£…ä¾‹

```python
from langgraph.checkpoint.memory import MemorySaver

# ãƒ¡ãƒ¢ãƒªãƒ™ãƒ¼ã‚¹ã®ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ
memory = MemorySaver()
graph = workflow.compile(checkpointer=memory)

# ã‚¹ãƒ¬ãƒƒãƒ‰IDã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œ
thread_id = "conversation_1"
result = graph.invoke(
    {"messages": ["Hello"]},
    config={"configurable": {"thread_id": thread_id}}
)
```

## ğŸ¯ å®Ÿè·µã¸ã®æº–å‚™

ã“ã‚Œã‚‰ã®æ¦‚å¿µã‚’ç†è§£ã—ãŸã¨ã“ã‚ã§ã€æ¬¡ã¯å®Ÿéš›ã«ç’°å¢ƒã‚’æº–å‚™ã—ã¦ã€ã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### ç†è§£åº¦ãƒã‚§ãƒƒã‚¯

ä»¥ä¸‹ã®è³ªå•ã«ç­”ãˆã‚‰ã‚Œã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼š

1. ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã®å½¹å‰²ã¯ï¼Ÿ
2. StateGraphã§çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹åˆ©ç‚¹ã¯ï¼Ÿ
3. ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆæ©Ÿèƒ½ã§ä½•ãŒã§ãã‚‹ï¼Ÿ

æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€å®Ÿéš›ã«ã“ã‚Œã‚‰ã®æ¦‚å¿µã‚’ä½¿ã£ã¦ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚
